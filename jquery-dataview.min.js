
function jquery_dataView($)
{var m_version='1.0';var m_exposed={getData:getData,version:function(jo){return m_version;}};var m_defaults={props:{},events:{}};var m_ifstack=[];var m_ifval=false;function getData(jo,exact)
{if(exact)
return jo.data("dvData_");var dvData;while((dvData=jo.data("dvData_"))===undefined){jo=jo.parent();if(jo.size()==0)
break;}
return dvData;}
function setData(jo,data)
{jo.data("dvData_",data);}
function setDataView(jo,data,opt,doInit,doSetData)
{if(jo.size()==0)
return jo;var vfor;if(doInit&&(vfor=jo.attr("dv-for"))){var isThis=(vfor=='this');var arrData=isThis?data:data[vfor];if(!$.isArray(arrData)){console.log("!!! warn: not array: "+vfor);return $([]);}
var opt1;if(!isThis){opt1=(opt.children&&opt.children[vfor])||{};opt1.events=opt.events;}
else{opt1=opt;}
var joRet=$([]);$.each(arrData,function(i,data1){var jo1=jo.clone();jo1.removeAttr("dv-for");if(!isThis)
data1.$parent=data;jo1=setDataView(jo1,data1,opt1,doInit,true);jo1.insertBefore(jo);joRet=joRet.add(jo1);});jo.remove();return joRet;}
if(doInit&&doSetData){setData(jo,data);if(opt.props){$.extend(data,opt.props);}}
if(!doInit&&getData(jo,true)!=null){var dvData=getData(jo);if(dvData==null)
$.error("*** dataview does not init");data=dvData;}
var val,val1;if(doInit){if(val=jo.attr("dv-if")){val1=!!evalWithin(data,val);m_ifval=val1;if(!m_ifval){jo.remove();return $([]);}
jo.removeAttr("dv-if");}
else if(val=jo.attr("dv-elseif")){if(m_ifval){jo.remove();return $([]);}
m_ifval=!!evalWithin(data,val);if(!m_ifval){jo.remove();return $([]);}
jo.removeAttr("dv-elseif");}
else if((val=jo.attr("dv-else"))!=null){if(m_ifval){jo.remove();return $([]);}
jo.removeAttr("dv-else");}}
if(val=jo.attr("dv-show")){val1=!!evalWithin(data,val);jo.toggle(val1);}
if(doInit&&(val=jo.attr("dv-on"))){$.each(val.split(/\s*,\s*/),function(){var fname=this.toString();var fn=opt.events[fname];if(fn==null){$.error("*** no event handler: "+fname);}
if(ms=fname.match(/_(\w+)/)){jo.on(ms[1],data,fn);}});}
if(jo.attr("name")){setItemContentByName(jo,data);}
if(doInit){m_ifstack.push(m_ifval);m_ifval=false;}
$.each(jo.children(),function(i,child){setDataView($(child),data,opt,doInit);});if(doInit){m_ifval=m_ifstack.pop();}
return jo;}
function evalWithin(data,code__080909)
{with(data){return eval(code__080909);}}
function evalSimple(data,name)
{return eval('data.'+name);}
function setItemContentByName(ji,data)
{var name=ji.attr("name");var content=null;if(name.indexOf('.')<0){content=data[name];}
else{content=evalSimple(data,name);}
if($.isFunction(content)){content=content.apply(data);}
setItemContent(ji,content);}
function setItemContent(ji,content)
{var isInput=ji.is(":input");if(content===undefined){if(isInput){if(ji[0].tagName==="TEXTAREA")
content=ji.html();else
content=ji.attr("value");if(content===undefined)
content="";}
else{content="";}}
if(ji.is(":input")){ji.val(content);}
else{ji.html(content);}}
$.fn.extend({dataview:function(data,opt){if(typeof(data)=="string")
{if(!m_exposed[data])
$.error("*** unknown call: "+data);var fn=m_exposed[data];arguments[0]=this;return fn.apply(this,arguments);}
if(data==null||getData(this)!=null)
return setDataView(this);var opt1=$.extend({},m_defaults,opt);if(this.size()!=1){$.error("*** dataview: MUST only one DOM object.");}
return setDataView(this,data,opt1,true,true);}});$.fn.dataview.defaults=m_defaults;}
jquery_dataView(window.jQuery);